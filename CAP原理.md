# CAP原理介绍
在一个分布式系统（指互相连接并共享数据节点的集合）中，当涉及读写操作时，只能保证一致性（Consistence）、可用性（Availability）、分区容错性（Partition Tolerance）三者中的两个，另外一个必须被牺牲。
# CAP原理的前提条件
基本前提条件：多个数据备份节点的分布式系统。默认的前提条件：两个分区之间的数据同步没有延迟。
# C、A、P
## Consistence一致性
对某个指定的客户端来说，读操作保证能够返回最新的写操作结果。
## Availability可用性
非故障的节点在合理的时间内返回合理的响应（不是错误和超时的响应）。
## Partition Tolerance分区容忍性
当出现网络分区后，系统能够继续履行职责。大多数分布式系统都分布在多个子网络。每个子网络就叫做一个区（ partition ）。分区容错的意思是，区间通信可能失
败，在失败时，每个分区仍然能够继续提供服务。比如，一台服务器放在中国，另一台服务器放在美国，这就是两个区，它们之间可能无法通信。
# 为什么C、A、P只能满足其中的两个？
分布式环境（多个数据备份节点的分布式系统）的前提下，我们必须选择P(分区容错)要素，因为网络本身无法做到100%可靠，有可能出故障，所以分区是一个必然的现象。
如果我们选择了CA而放弃了P，那么当发生分区现象时，为了保证C，系统需要禁止写入，当有写入请求时，系统返回error，这又和A冲突了，因为A要求返回no error 和no timeout。因此，分布式系统理论上不可能选择CA架构，只能选择CP或者AP架构。
# CAP存在的问题
在CAP理论中，有一点很理想化，它没有考虑网络延迟，他认为C都是立刻生效的，实际上同步这个操作肯定存在延迟。因此对于分布式系统，我们一般都采用AP。
# CA\AP\CP如何选择？
选择CP/AP其实一个很大的难题。一个系统里有很多个功能和业务，而对于不同的业务和功能，我们可以选择不同的模型。举个例子，我们做一个秒杀系统，查询商品的时候我们可以选择AP架构，短时间的数据不一致，保证用户可以查询出列表，但购买商品的时候，我们要选择CP架构，没有库存，就不能进行购买。但是整个秒杀系统，不是AP也不是CP，而是AP和CP的混合。
所以在实际的设计和开发中，我们要灵活运用CAP理论，灵活选择AP或CP架构。

# CA取舍
![网络分区时的状态](https://github.com/fujianye/DailyGain/edit/master/CAP%E5%8E%9F%E7%90%86.md '描述信息')

# CAP原理应用场景
## 适合CAP原理的场景

## 不适合CAP原理的场景

# 支付系统中CAP原理的应用场景



根据分布式系统中CAP原则，当P(分区容忍)发生的时候，强行追求C（一致性），会导致（A）可用性、吞吐量下降，此时我们一般用最终一致性来保证我们系统的AP能力。当然不是说放弃C，而是在一般情况下CAP都能保证，在发生分区的情况下，我们可以通过最终一致性来保证数据一致。
